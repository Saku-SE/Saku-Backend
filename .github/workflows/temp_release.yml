name: temp-release

on:
  push:
    branches-ignore:
      - 'main'
      - 'develop'
  # pull_request:
  #   branches: [develop]

jobs:
  test:
    runs-on: ubuntu-latest

    # env:
    #   GITHUB_TOKEN: ${{ secrets.PAT }}

    steps:
    - uses: actions/checkout@v2

    # - id: release
    #   uses: rymndhng/release-on-push-action@master
    #   with:
    #       bump_version_scheme: minor

    - name: build docker
      run: |
        docker build . -t ghcr.io/saku-se/saku-backend:${{ github.sha }}

    - name: push
      run: |
        docker login -u ${{ github.actor }} -p ${{ secrets.GITHUB_TOKEN }}
        docker push ghcr.io/saku-se/saku-backend:${{ github.sha }}
      # run: |
      #   docker login --username=${{ secrets.BACK_REG_USERNAME }} --password=${{ secrets.BACKEND_PAT }} ghcr.io
      #   docker push ghcr.io/a_roodgar/saku-se:${{ github.sha }}

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# GitHub recommends pinning actions to a commit SHA.
# To get a newer version, you will need to update the SHA.
# You can also reference a tag or branch, but the action may change without warning.

# name: Create and publish a Docker image

# on:
#   push:
#     # branches: ['release']
#     branches-ignore:
#       - 'main'
#       - 'develop'

# env:
#   REGISTRY: ghcr.io
#   IMAGE_NAME: ${{ github.repository }}
#   IMAGE_TAG: ${{ github.sha }}

# jobs:
#   build-and-push-image:
#     runs-on: ubuntu-latest
#     permissions:
#       contents: read
#       packages: write

#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v3

#       - name: Log in to the Container registry
#         # uses: docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9
#         uses: docker/login-action@v2
#         with:
#           # registry: ${{ env.REGISTRY }}
#           registry: ghcr.io
#           username: ${{ github.actor }}
#           password: ${{ secrets.GITHUB_TOKEN }}

#       - name: Extract metadata (tags, labels) for Docker
#         id: meta
#         uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38
#         with:
#           # images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
#           images: ghcr.io/saku-se

#       - name: Build and push Docker image
#         # uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc
#         uses: docker/build-push-action@v4
#         with:
#           context: .
#           push: true
#           # tags: ${{ steps.meta.outputs.tags }}
#           # tags: ${{ github.sha }}
#           tags: saku-backend:${{ env.IMAGE_TAG }}
#           # tags: ${{ env.IMAGE_TAG }}
#           # labels: ${{ steps.meta.outputs.labels }}